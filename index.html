<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>uppptip</title>
<link rel="preconnect" href="https://cdnjs.cloudflare.com">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
/*========== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========*/
:root{
 --bg-main:#f5f7fa;--bg-grad:#c3cfe2;--bg-card:#fff;
 --bg-overlay:rgba(0,0,0,.5);--txt-main:#333;--txt-faded:#666;
 --accent:#007BFF;--border:#ddd;--row-alt:#f9fbff
}
body.dark{
 --bg-main:#1e1e1e;--bg-grad:#343a40;--bg-card:#2b2b2b;
 --bg-overlay:rgba(0,0,0,.7);--txt-main:#e9e9e9;--txt-faded:#aaa;
 --accent:#4dabff;--border:#444;--row-alt:#24292f
}
/*========== –°–ë–†–û–° / –û–ë–©–ï–ï ==========*/
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
html,body{height:100%}
body{background:linear-gradient(135deg,var(--bg-main) 0%,var(--bg-grad) 100%);color:var(--txt-main);transition:.3s}

/*========== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ==========*/
#authSection{display:flex;align-items:center;justify-content:center;min-height:100vh}
.auth-container{background:var(--bg-card);padding:25px 20px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.2);width:320px;text-align:center;animation:fade .4s}
@keyframes fade{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.auth-tabs{display:flex;justify-content:center;align-items:center;margin-bottom:20px}
.auth-tab{font-size:1.1rem;color:var(--txt-faded);padding:5px 15px;cursor:pointer;transition:.3s}
.auth-tab.active{color:var(--accent);font-size:1.25rem;transform:scale(1.08)}
#toggleEmoji{margin:0 10px;font-size:1.5rem;cursor:pointer}
.auth-form-group{margin-bottom:14px;text-align:left}
.auth-form-group label{display:block;font-weight:600;margin-bottom:4px;font-size:.9rem}
.auth-form-group input{width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;background:var(--bg-main);color:var(--txt-main)}
.auth-buttons button{background:var(--accent);color:#fff;border:none;padding:9px 0;width:100%;border-radius:4px;font-size:1rem;cursor:pointer;transition:.3s}
.auth-buttons button:hover{filter:brightness(.9)}

/*========== –û–°–ù–û–í–ê ==========*/
#mainSection{display:none;min-height:100%;display:flex;flex-direction:column}
header{display:flex;justify-content:space-between;align-items:center;background:var(--bg-card);padding:13px 20px;box-shadow:0 2px 5px rgba(0,0,0,.15)}
.logo{font-size:1.35rem;font-weight:700;animation:pulse 3s infinite alternate}
@keyframes pulse{to{color:var(--accent)}}
nav ul{list-style:none;display:flex;gap:18px;font-weight:500}
nav li{cursor:pointer;transition:.3s}
nav li:hover{color:var(--accent);transform:scale(1.05)}
.extra{display:flex;align-items:center;gap:14px}
.search-bar{display:flex;align-items:center;gap:6px}
.search-bar input{width:190px;padding:5px 9px;border:1px solid var(--border);border-radius:4px;background:var(--bg-card);color:var(--txt-main)}
.star-icon,.theme-toggle{font-size:1.3rem;cursor:pointer}
.star-icon.active{color:gold}
.profile-icon{width:42px;height:42px;border-radius:50%;background:var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.3s}
.profile-icon:hover{transform:scale(1.1);background:var(--txt-faded)}
.export-btn{font-size:1.35rem;cursor:pointer}

main{flex:1;display:flex;flex-direction:column;align-items:center;padding:28px 20px}
.tabs{display:flex;gap:14px;margin-bottom:22px;flex-wrap:wrap}
.tab-btn{padding:6px 14px;border:1px solid var(--border);border-radius:20px;background:var(--bg-card);cursor:pointer;font-size:.9rem;transition:.25s}
.tab-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:25px;max-width:1100px;width:100%}
.card{background:var(--bg-card);border:2px solid var(--border);border-radius:10px;height:140px;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:.3s;text-align:center;padding:10px;font-size:1rem}
.card:hover{transform:translateY(-6px) scale(1.02);box-shadow:0 8px 18px rgba(0,0,0,.1)}

footer{padding:18px 0;text-align:center;color:var(--txt-faded);font-size:.9rem}

/*========== –ú–û–î–ê–õ–ö–ê ==========*/
.modal-overlay{display:none;position:fixed;inset:0;justify-content:center;align-items:center;background:var(--bg-overlay);backdrop-filter:blur(3px);z-index:1000}
.modal-content{background:var(--bg-card);width:92%;max-width:1000px;border-radius:8px;max-height:92vh;overflow:auto;animation:slide .3s}
@keyframes slide{from{opacity:0;transform:translateY(-50px)}to{opacity:1;transform:none}}
.close-modal{position:absolute;top:16px;right:18px;font-size:1.6rem;cursor:pointer;color:var(--txt-faded)}
.close-modal:hover{color:var(--txt-main)}
.modal-header{display:flex;justify-content:space-between;align-items:center;padding:14px 20px;background:var(--accent);color:#fff;border-radius:8px 8px 0 0}
.save-all{background:#fff;color:var(--accent);border:none;padding:4px 10px;border-radius:4px;font-size:.9rem;cursor:pointer;transition:.2s}
.save-all:hover{filter:brightness(.9)}
.modal-body{padding:22px}
.step-row{display:grid;grid-template-columns:120px 1fr 1fr;gap:20px;margin-bottom:22px;padding:14px;border-radius:6px}
.step-row:nth-child(odd){background:var(--row-alt)}
@media(max-width:900px){.step-row{grid-template-columns:1fr}.step-circle{margin:0 auto 8px}}
.step-circle{width:90px;height:90px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;border:2px solid var(--accent);color:var(--accent);text-align:center;padding:10px;font-size:.9rem;background:var(--bg-card)}
.step-input,.example-textarea{width:100%;height:110px;border:1px solid var(--border);border-radius:4px;padding:10px;font-size:.9rem;resize:none;background:var(--bg-main);color:var(--txt-main)}
.example-column{display:flex;flex-direction:column;gap:6px}
.example-column label{font-size:.82rem;font-weight:700;color:var(--txt-faded)}
.download-circle{width:42px;height:42px;border-radius:50%;background:var(--accent);color:#fff;display:flex;align-items:center;justify-content:center;font-size:1.25rem;cursor:pointer;transition:.3s}
.download-circle:hover{filter:brightness(.9);transform:scale(1.08)}

/*========== –ö–ê–ë–ò–ù–ï–¢ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ==========*/
#cabinetSection{display:none;min-height:100vh;padding:30px}
.cabinet-container{background:var(--bg-card);max-width:620px;margin:auto;padding:25px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.2)}
.cabinet-title{font-size:1.25rem;color:var(--accent);margin-bottom:20px;text-align:center}
.cabinet-profile{display:flex;flex-direction:column;align-items:center;margin-bottom:20px}
.cabinet-avatar-img{width:110px;height:110px;border-radius:50%;object-fit:cover;display:none}
.cabinet-avatar-emoji{font-size:70px;display:none}
.cabinet-username{font-weight:700;font-size:1.05rem;margin-top:6px}
.cabinet-actions{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-bottom:20px}
.cabinet-btn{background:var(--accent);color:#fff;border:none;padding:8px 14px;border-radius:4px;cursor:pointer;font-size:.95rem}
.cabinet-btn:hover{filter:brightness(.9)}
.cabinet-settings-form{display:none}
.cabinet-form-group{margin-bottom:12px}
.cabinet-form-group input{width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;background:var(--bg-main);color:var(--txt-main)}
.cabinet-save-btn{background:#28a745;color:#fff;border:none;padding:8px 14px;border-radius:4px;font-size:.95rem}
</style>
</head>
<body>
<!-- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø -->
<section id="authSection">
 <div class="auth-container">
  <div class="auth-tabs">
   <span class="auth-tab active" id="loginTab">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</span>
   <span id="toggleEmoji">‚áÜ</span>
   <span class="auth-tab" id="registerTab">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
  </div>
  <div id="loginForm">
   <div class="auth-form-group"><label>–õ–æ–≥–∏–Ω</label><input id="loginUsername"></div>
   <div class="auth-form-group"><label>–ü–∞—Ä–æ–ª—å</label><input type="password" id="loginPassword"></div>
   <div class="auth-buttons"><button id="loginBtn">–í–æ–π—Ç–∏</button></div>
  </div>
  <div id="registerForm" style="display:none">
   <div class="auth-form-group"><label>–õ–æ–≥–∏–Ω</label><input id="regUsername"></div>
   <div class="auth-form-group"><label>–ü–∞—Ä–æ–ª—å</label><input type="password" id="regPassword"></div>
   <div class="auth-buttons"><button id="registerBtn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button></div>
  </div>
 </div>
</section>

<!-- –û–°–ù–û–í–ê -->
<section id="mainSection">
<header>
 <div class="logo">uppptip</div>
 <nav><ul><li>–ì–ª–∞–≤–Ω–∞—è</li><li>–°–æ–±—ã—Ç–∏—è</li><li>–û—Ç—á—ë—Ç—ã</li><li>–ö–µ–π—Å—ã</li></ul></nav>
 <div class="extra">
  <div class="search-bar"><input id="searchInput" placeholder="–ü–æ–∏—Å–∫"><span class="star-icon" id="favToggle">‚≠ê</span></div>
  <span class="export-btn" id="exportBtn" title="–≠–∫—Å–ø–æ—Ä—Ç ZIP">üì¶</span>
  <span class="theme-toggle" id="themeToggle">üåû</span>
  <div class="profile-icon" id="profileIcon">üë§</div>
 </div>
</header>

<main>
 <div class="tabs">
   <button class="tab-btn active" data-cat="all">–í—Å–µ</button>
   <button class="tab-btn" data-cat="analitica">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
   <button class="tab-btn" data-cat="plan">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
   <button class="tab-btn" data-cat="monitor">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</button>
 </div>
 <div class="cards-grid" id="cardsGrid"></div>
</main>
<footer>¬© 2025 uppptip</footer>
<div id="modalsContainer"></div>
</section>

<!-- –õ–ò–ß–ù–´–ô –ö–ê–ë–ò–ù–ï–¢ (–±–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
<section id="cabinetSection">
 <div class="cabinet-container">
  <h2 class="cabinet-title">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
  <div class="cabinet-profile">
   <img id="cabinetAvatar" class="cabinet-avatar-img">
   <div id="cabinetEmoji" class="cabinet-avatar-emoji">üòÉ</div>
   <div class="cabinet-username" id="cabinetUsername"></div>
  </div>
  <div class="cabinet-actions">
   <button class="cabinet-btn" id="openSettingsBtn">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
   <button class="cabinet-btn" id="backToMainBtn">–ù–∞–∑–∞–¥</button>
   <button class="cabinet-btn" id="logoutBtnCabinet">–í—ã–π—Ç–∏</button>
  </div>
  <div id="cabinetSettingsForm" class="cabinet-settings-form">
   <div class="cabinet-form-group"><label>–ù–æ–≤—ã–π –ª–æ–≥–∏–Ω</label><input id="newUsername"></div>
   <div class="cabinet-form-group"><label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label><input type="password" id="newPassword"></div>
   <div class="cabinet-form-group"><label>–ù–æ–≤—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç</label><input type="file" id="avatarFile" accept="image/*"></div>
   <button class="cabinet-save-btn" id="saveSettingsBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
 </div>
</section>

<script>
/*======== localStorage =========*/
let users=JSON.parse(localStorage.getItem('users'))||[];
let currentUser=JSON.parse(localStorage.getItem('currentUser'))||null;
let favCards=JSON.parse(localStorage.getItem('favCards'))||[];
let theme=localStorage.getItem('theme')||'light';
function saveLS(){localStorage.setItem('users',JSON.stringify(users));localStorage.setItem('currentUser',JSON.stringify(currentUser));localStorage.setItem('favCards',JSON.stringify(favCards))}

/*======== –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–µ–∫ (16) =========*/
const cards=[
 {id:'swot',title:'SWOT-–∞–Ω–∞–ª–∏–∑',cat:'analitica',steps:['–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã','–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã','–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏','–£–≥—Ä–æ–∑—ã']},
 {id:'pest',title:'PEST-–∞–Ω–∞–ª–∏–∑',cat:'analitica',steps:['–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ','–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ','–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ','–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ']},
 {id:'porter',title:'5 —Å–∏–ª –ü–æ—Ä—Ç–µ—Ä–∞',cat:'analitica',steps:['–°–∏–ª–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤','–°–∏–ª–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π','–£–≥—Ä–æ–∑–∞ –Ω–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤','–£–≥—Ä–æ–∑–∞ –∑–∞–º–µ–Ω–∏—Ç–µ–ª–µ–π','–ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è']},
 {id:'lean',title:'Lean Canvas',cat:'plan',steps:['–ü—Ä–æ–±–ª–µ–º—ã','–°–µ–≥–º–µ–Ω—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤','–£–¢–ü','–†–µ—à–µ–Ω–∏–µ','–ö–∞–Ω–∞–ª—ã','–î–æ—Ö–æ–¥—ã','–ó–∞—Ç—Ä–∞—Ç—ã']},
 {id:'bmc',title:'Business Model Canvas',cat:'plan',steps:['–¶–ü','–ö–ª–∏–µ–Ω—Ç—ã','–ö–∞–Ω–∞–ª—ã','–û—Ç–Ω–æ—à–µ–Ω–∏—è','–î–æ—Ö–æ–¥—ã','–†–µ—Å—É—Ä—Å—ã','–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å','–ü–∞—Ä—Ç–Ω—ë—Ä—ã','–ó–∞—Ç—Ä–∞—Ç—ã']},
 {id:'vpc',title:'Value Proposition Canvas',cat:'plan',steps:['–ü—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞','–ó–∞–¥–∞—á–∏','–ë–æ–ª–∏','–í—ã–≥–æ–¥—ã','–ü—Ä–æ–¥—É–∫—Ç','–£—Å—Ç—Ä–∞–Ω–∏—Ç–µ–ª–∏ –±–æ–ª–µ–π','–°–æ–∑–¥–∞—Ç–µ–ª–∏ –≤—ã–≥–æ–¥']},
 {id:'smart',title:'SMART-—Ü–µ–ª–∏',cat:'monitor',steps:['–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ—Å—Ç—å','–ò–∑–º–µ—Ä–∏–º–æ—Å—Ç—å','–î–æ—Å—Ç–∏–∂–∏–º–æ—Å—Ç—å','–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å','–°—Ä–æ–∫']},
 {id:'okr',title:'OKR-–ø–ª–∞–Ω',cat:'monitor',steps:['Objective','Key Result 1','Key Result 2','Key Result 3']},
 {id:'raci',title:'RACI-–º–∞—Ç—Ä–∏—Ü–∞',cat:'monitor',steps:['–ó–∞–¥–∞—á–∞','–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π','–£—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç','–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–µ—Ç','–ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç']},
 {id:'kpi',title:'KPI-–¥–∞—à–±–æ—Ä–¥',cat:'monitor',steps:['–ú–µ—Ç—Ä–∏–∫–∞','–¢–µ–∫—É—â–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å','–¶–µ–ª—å','–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö']},
 {id:'risk',title:'–ú–∞—Ç—Ä–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤',cat:'analitica',steps:['–†–∏—Å–∫','–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å','–í–ª–∏—è–Ω–∏–µ','–°—Ç—Ä–∞—Ç–µ–≥–∏—è']},
 {id:'stake',title:'–ö–∞—Ä—Ç–∞ —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–æ–≤',cat:'analitica',steps:['–°—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä','–ò–Ω—Ç–µ—Ä–µ—Å','–í–ª–∏—è–Ω–∏–µ','–°—Ç—Ä–∞—Ç–µ–≥–∏—è']},
 {id:'moscow',title:'MoSCoW-–ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è',cat:'plan',steps:['Must Have','Should Have','Could Have','Won‚Äôt Have']},
 {id:'usm',title:'User Story Map',cat:'plan',steps:['–≠–ø–∏–∫–∏','–î–µ–π—Å—Ç–≤–∏—è','User Stories','–†–µ–ª–∏–∑—ã']},
 {id:'gantt',title:'–ì–∞–Ω—Ç—Ç-–¥–∏–∞–≥—Ä–∞–º–º–∞',cat:'plan',steps:['–ó–∞–¥–∞—á–∞','–ù–∞—á–∞–ª–æ','–ö–æ–Ω–µ—Ü','–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π','–ü—Ä–æ–≥—Ä–µ—Å—Å']},
 {id:'bsc',title:'Balanced Scorecard',cat:'monitor',steps:['–§–∏–Ω–∞–Ω—Å—ã','–ö–ª–∏–µ–Ω—Ç—ã','–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã','–û–±—É—á–µ–Ω–∏–µ –∏ —Ä–æ—Å—Ç']}
];

/*======== DOM =========*/
const authSection=document.getElementById('authSection');
const mainSection=document.getElementById('mainSection');
const cabinetSection=document.getElementById('cabinetSection');
const cardsGrid=document.getElementById('cardsGrid');
const modalsContainer=document.getElementById('modalsContainer');
const searchInput=document.getElementById('searchInput');
const favToggle=document.getElementById('favToggle');
const themeToggle=document.getElementById('themeToggle');
const exportBtn=document.getElementById('exportBtn');
/* auth */
const loginForm=document.getElementById('loginForm'),registerForm=document.getElementById('registerForm');
const loginTab=document.getElementById('loginTab'),registerTab=document.getElementById('registerTab'),toggleEmoji=document.getElementById('toggleEmoji');
const loginUsername=document.getElementById('loginUsername'),loginPassword=document.getElementById('loginPassword');
const regUsername=document.getElementById('regUsername'),regPassword=document.getElementById('regPassword');
/* profile */
const profileIcon=document.getElementById('profileIcon'),cabinetUsername=document.getElementById('cabinetUsername'),cabinetAvatar=document.getElementById('cabinetAvatar'),cabinetEmoji=document.getElementById('cabinetEmoji');
const openSettingsBtn=document.getElementById('openSettingsBtn'),cabinetSettingsForm=document.getElementById('cabinetSettingsForm'),backToMainBtn=document.getElementById('backToMainBtn'),logoutBtnCabinet=document.getElementById('logoutBtnCabinet');
const newUsername=document.getElementById('newUsername'),newPassword=document.getElementById('newPassword'),avatarFile=document.getElementById('avatarFile');

/*======== helpers =========*/
function applyTheme(){document.body.classList.toggle('dark',theme==='dark');themeToggle.textContent=theme==='dark'?'üåö':'üåû'}
applyTheme();themeToggle.onclick=()=>{theme=theme==='dark'?'light':'dark';localStorage.setItem('theme',theme);applyTheme()}
function updateView(){authSection.style.display=currentUser?'none':'flex';mainSection.style.display=currentUser?'flex':'none';cabinetSection.style.display='none'}
updateView();
function showLogin(){loginTab.classList.add('active');registerTab.classList.remove('active');loginForm.style.display='block';registerForm.style.display='none'}
function showRegister(){registerTab.classList.add('active');loginTab.classList.remove('active');loginForm.style.display='none';registerForm.style.display='block'}
loginTab.onclick=showLogin;registerTab.onclick=showRegister;toggleEmoji.onclick=()=>loginForm.style.display==='block'?showRegister():showLogin();
document.getElementById('loginBtn').onclick=()=>{const u=loginUsername.value.trim(),p=loginPassword.value.trim();const me=users.find(x=>x.username===u&&x.password===p);if(me){currentUser=me;saveLS();updateView()}else alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å')};
document.getElementById('registerBtn').onclick=()=>{const u=regUsername.value.trim(),p=regPassword.value.trim();if(!u||!p)return alert('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ');if(users.find(x=>x.username===u))return alert('–õ–æ–≥–∏–Ω –∑–∞–Ω—è—Ç');currentUser={username:u,password:p,avatar:''};users.push(currentUser);saveLS();updateView()};
/* –∫–∞–±–∏–Ω–µ—Ç */
function updAvatar(){if(currentUser?.avatar){cabinetAvatar.src=currentUser.avatar;cabinetAvatar.style.display='block';cabinetEmoji.style.display='none'}else{cabinetAvatar.style.display='none';cabinetEmoji.style.display='block'}}
profileIcon.onclick=()=>{if(!currentUser)return alert('–í–æ–π–¥–∏—Ç–µ!');cabinetUsername.textContent=currentUser.username;updAvatar();mainSection.style.display='none';cabinetSection.style.display='block'};
backToMainBtn.onclick=()=>{cabinetSection.style.display='none';mainSection.style.display='flex'};
logoutBtnCabinet.onclick=()=>{currentUser=null;saveLS();updateView()};
openSettingsBtn.onclick=()=>cabinetSettingsForm.style.display=cabinetSettingsForm.style.display==='block'?'none':'block';
document.getElementById('saveSettingsBtn').onclick=()=>{if(!currentUser)return;const nu=newUsername.value.trim(),np=newPassword.value.trim();if(nu&&nu!==currentUser.username){if(users.some(x=>x.username===nu))return alert('–õ–æ–≥–∏–Ω –∑–∞–Ω—è—Ç');currentUser.username=nu}if(np)currentUser.password=np;if(avatarFile.files[0]){const r=new FileReader();r.onload=e=>{currentUser.avatar=e.target.result;finish()};r.readAsDataURL(avatarFile.files[0])}else finish();function finish(){users=users.map(x=>x===currentUser?currentUser:x);saveLS();updAvatar();cabinetUsername.textContent=currentUser.username;cabinetSettingsForm.style.display='none';newUsername.value='';newPassword.value='';avatarFile.value='';alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ')}}

/*======== –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ ========*/
function roman(i){const r=['I','II','III','IV','V','VI','VII','VIII','IX','X'];return r[i]||i+1}
function buildCards(){cardsGrid.innerHTML='';modalsContainer.innerHTML='';const filter=document.querySelector('.tab-btn.active').dataset.cat;const ordered=[...cards].filter(c=>filter==='all'||c.cat===filter).sort((a,b)=>(favCards.includes(a.id)?-1:1)+(favCards.includes(b.id)?1:-1));ordered.forEach(card=>{const div=document.createElement('div');div.className='card';div.dataset.id=card.id;div.textContent=card.title;cardsGrid.appendChild(div); /* modal */const modal=document.createElement('div');modal.className='modal-overlay';modal.id='m_'+card.id;modal.innerHTML=`<div class="modal-content"><span class="close-modal">&times;</span><div class="modal-header"><span>${card.title}</span><button class="save-all" data-save="${card.id}">üíæ –°–∫–∞—á–∞—Ç—å –≤—Å—ë</button></div><div class="modal-body">${card.steps.map((s,i)=>`<div class="step-row"><div class="step-circle">${roman(i)}</div><textarea class="step-input" placeholder="${s}..." data-input="${card.id}_${i}"></textarea><div class="example-column"><label>–ü—Ä–∏–º–µ—Ä</label><textarea class="example-textarea" placeholder="–ü—Ä–∏–º–µ—Ä: ${s.toLowerCase()}..." data-example="${card.id}_${i}"></textarea><div class="download-circle" data-dl="${card.id}_${i}">‚¨á</div></div></div>`).join('')}</div></div>`;modalsContainer.appendChild(modal)})}
buildCards();

/*======== –≤–∫–ª–∞–¥–∫–∏-—Ñ–∏–ª—å—Ç—Ä—ã =========*/
document.querySelectorAll('.tab-btn').forEach(b=>b.onclick=()=>{document.querySelector('.tab-btn.active').classList.remove('active');b.classList.add('active');buildCards();applySearch()})

/*======== –æ—Ç–∫—Ä—ã—Ç–∏–µ / –∏–∑–±—Ä–∞–Ω–Ω–æ–µ =========*/
cardsGrid.onclick=e=>{
 const c=e.target.closest('.card');if(!c)return;
 if(favToggle.classList.contains('active')){const id=c.dataset.id;if(favCards.includes(id))favCards=favCards.filter(x=>x!==id);else favCards.push(id);saveLS();favToggle.classList.remove('active');buildCards();applySearch();return}
 openModal(c.dataset.id);
};
function openModal(id){const m=document.getElementById('m_'+id);m.style.display='flex';m.querySelectorAll('textarea').forEach(t=>{const key=(currentUser?.username||'guest')+'_'+(t.dataset.input?`in_${t.dataset.input}`:`ex_${t.dataset.example}`);t.value=localStorage.getItem(key)||''})}

/*======== –∑–∞–∫—Ä—ã—Ç–∏–µ / —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ / save-all =========*/
modalsContainer.onclick=e=>{
 if(e.target.classList.contains('modal-overlay'))e.target.style.display='none';
 if(e.target.classList.contains('close-modal'))e.target.closest('.modal-overlay').style.display='none';
 /* —Å–∫–∞—á–∞—Ç—å –æ–¥–∏–Ω —à–∞–≥ */
 if(e.target.dataset.dl){
   const [cid,idx]=e.target.dataset.dl.split('_');const step=cards.find(c=>c.id===cid).steps[idx];
   const txt=document.querySelector(`[data-example="${cid}_${idx}"]`).value;
   download(`${cid}_${idx}.txt`,`${step}:\n${txt}`);
 }
 /* save-all */
 if(e.target.dataset.save){
   const cid=e.target.dataset.save;const card=cards.find(c=>c.id===cid);
   let content=`${card.title}\n========================\n`;
   card.steps.forEach((s,i)=>{const inVal=document.querySelector(`[data-input="${cid}_${i}"]`).value;const exVal=document.querySelector(`[data-example="${cid}_${i}"]`).value;content+=`‚¨§ ${s}\n–ü–æ–ª–µ: ${inVal}\n–ü—Ä–∏–º–µ—Ä: ${exVal}\n\n`});
   download(`${cid}.txt`,content);
 }
};
/* –∞–≤—Ç–æ—Å–µ–π–≤ */
modalsContainer.addEventListener('input',e=>{
 if(!e.target.matches('textarea'))return;
 const t=e.target;const key=(currentUser?.username||'guest')+'_'+(t.dataset.input?`in_${t.dataset.input}`:`ex_${t.dataset.example}`);localStorage.setItem(key,t.value);
});

/*======== –ø–æ–∏—Å–∫ =========*/
function applySearch(){const q=searchInput.value.toLowerCase();document.querySelectorAll('.card').forEach(c=>{c.style.display=c.textContent.toLowerCase().includes(q)?'flex':'none'})}
searchInput.oninput=applySearch;

/*======== fav toggle =========*/
favToggle.onclick=()=>favToggle.classList.toggle('active');

/*======== util download =========*/
function download(name,content){const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([content],{type:'text/plain'}));a.download=name;a.click();URL.revokeObjectURL(a.href)}

/*======== ZIP-—ç–∫—Å–ø–æ—Ä—Ç =========*/
exportBtn.onclick=async()=>{
 const zip=new JSZip();const uname=currentUser?.username||'guest';
 cards.forEach(card=>{
   let txt=`${card.title}\n========================\n`;
   card.steps.forEach((s,i)=>{const inKey=`${uname}_in_${card.id}_${i}`,exKey=`${uname}_ex_${card.id}_${i}`;const inVal=localStorage.getItem(inKey)||'';const exVal=localStorage.getItem(exKey)||'';txt+=`‚¨§ ${s}\n–ü–æ–ª–µ: ${inVal}\n–ü—Ä–∏–º–µ—Ä: ${exVal}\n\n`});
   zip.file(`${card.title}.txt`,txt);
 });
 const blob=await zip.generateAsync({type:'blob'});
 const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='uppptip_export.zip';a.click();URL.revokeObjectURL(a.href);
};
</script>
</body>
</html>
