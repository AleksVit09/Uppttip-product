<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>uppptip</title>
  <style>
    /*==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================*/
    :root{
      --bg-main: #f5f7fa;
      --bg-grad: #c3cfe2;
      --bg-card: #fff;
      --bg-overlay: rgba(0,0,0,.5);
      --txt-main:#333;
      --txt-faded:#666;
      --accent:#007BFF;
      --border:#ddd;
    }
    body.dark{
      --bg-main:#1e1e1e;
      --bg-grad:#343a40;
      --bg-card:#2b2b2b;
      --bg-overlay:rgba(0,0,0,.7);
      --txt-main:#e9e9e9;
      --txt-faded:#aaa;
      --accent:#4dabff;
      --border:#444;
    }

    /*==================== –°–ë–†–û–° ====================*/
    *{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif;}

    body{
      background:linear-gradient(135deg,var(--bg-main) 0%,var(--bg-grad) 100%);
      color:var(--txt-main);transition:.3s background-color,.3s color;
    }
    a{color:inherit;text-decoration:none}

    /*==================== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ====================*/
    #authSection{display:flex;align-items:center;justify-content:center;min-height:100vh}
    .auth-container{background:var(--bg-card);padding:25px 20px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.2);width:320px;text-align:center;animation:fadeIn .5s}
    .auth-tabs{display:flex;justify-content:center;align-items:center;margin-bottom:20px}
    .auth-tab{font-size:1.1rem;color:var(--txt-faded);padding:5px 15px;cursor:pointer;transition:.3s}
    .auth-tab.active{color:var(--accent);font-size:1.3rem;transform:scale(1.08)}
    #toggleEmoji{font-size:1.5rem;margin:0 10px;cursor:pointer;transition:.3s}
    .auth-form-group{margin-bottom:15px;text-align:left}
    .auth-form-group label{display:block;margin-bottom:5px;font-weight:bold;font-size:.9rem}
    .auth-form-group input{width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;background:var(--bg-main);color:var(--txt-main)}
    .auth-buttons button{background:var(--accent);border:none;color:#fff;padding:10px 0;width:100%;border-radius:4px;font-size:1rem;cursor:pointer;transition:.3s}
    .auth-buttons button:hover{filter:brightness(.9)}

    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

    /*==================== –û–°–ù–û–í–ù–û–ô –†–ê–ó–î–ï–õ ====================*/
    #mainSection{display:none}
    header{display:flex;align-items:center;justify-content:space-between;background:var(--bg-card);padding:12px 18px;box-shadow:0 2px 5px rgba(0,0,0,.15);position:sticky;top:0;z-index:10}
    .logo{font-size:1.4rem;font-weight:bold;color:var(--txt-main);animation:pulseLogo 3s infinite alternate}
    @keyframes pulseLogo{0%{color:var(--txt-main)}100%{color:var(--accent)}}
    nav ul{list-style:none;display:flex;gap:20px;font-weight:500}
    nav li{cursor:pointer;transition:.3s}
    nav li:hover{color:var(--accent);transform:scale(1.05)}
    .extra-right{display:flex;align-items:center;gap:15px}
    .search-bar{display:flex;align-items:center;gap:8px}
    .search-bar input{padding:5px 10px;border:1px solid var(--border);border-radius:4px;width:200px;background:var(--bg-card);color:var(--txt-main)}
    .search-bar input:focus{outline:none;box-shadow:0 0 5px rgba(0,123,255,.5)}
    .star-icon{font-size:1.3rem;cursor:pointer;transition:.3s}
    .star-icon.active{color:gold}
    .theme-toggle{font-size:1.4rem;cursor:pointer;transition:transform .3s}
    .theme-toggle:hover{transform:rotate(20deg)}
    .profile-icon{width:40px;height:40px;border-radius:50%;background:var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.3s}
    .profile-icon:hover{transform:scale(1.1);background:var(--txt-faded)}

    main{max-width:1200px;margin:20px auto;padding:0 20px}
    .cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px}
    .card{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;height:110px;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:.3s;text-align:center;padding:8px}
    .card:hover{transform:translateY(-5px) scale(1.02);box-shadow:0 8px 15px rgba(0,0,0,.1)}

    footer{margin:25px 0;text-align:center;color:var(--txt-faded);font-size:.9rem}

    /*==================== –õ–ò–ß–ù–´–ô –ö–ê–ë–ò–ù–ï–¢ ====================*/
    #cabinetSection{display:none;min-height:100vh;padding:20px}
    .cabinet-container{background:var(--bg-card);max-width:600px;margin:40px auto;padding:20px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.2);animation:fadeIn .4s}
    .cabinet-title{font-size:1.25rem;margin-bottom:20px;color:var(--accent)}
    .cabinet-profile{display:flex;flex-direction:column;align-items:center;margin-bottom:20px}
    .cabinet-avatar-img{width:100px;height:100px;border-radius:50%;object-fit:cover;display:none}
    .cabinet-avatar-emoji{font-size:64px;display:none}
    .cabinet-username{font-weight:bold;font-size:1.05rem;margin-bottom:6px}
    .cabinet-actions{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:20px}
    .cabinet-btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:4px;font-size:.95rem;cursor:pointer;transition:.3s}
    .cabinet-btn:hover{filter:brightness(.9)}
    .cabinet-settings-form{display:none;text-align:left;margin-top:15px}
    .cabinet-form-group{margin-bottom:12px}
    .cabinet-form-group input{width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;background:var(--bg-main);color:var(--txt-main)}
    .cabinet-save-btn{background:#28a745;color:#fff;border:none;padding:8px 12px;border-radius:4px;font-size:.95rem;cursor:pointer}
    .cabinet-save-btn:hover{filter:brightness(.9)}

    /*==================== –ú–û–î–ê–õ–ö–ò ====================*/
    .modal-overlay{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;justify-content:center;align-items:center;background:var(--bg-overlay);backdrop-filter:blur(3px);z-index:1000;animation:fadeInOverlay .3s forwards}
    @keyframes fadeInOverlay{from{opacity:0}to{opacity:1}}
    .modal-content{background:var(--bg-card);width:90%;max-width:1000px;border-radius:8px;padding:20px;position:relative;animation:slideInDown .3s ease forwards;max-height:90vh;overflow:auto}
    @keyframes slideInDown{0%{transform:translateY(-50px);opacity:0}100%{transform:translateY(0);opacity:1}}
    .close-modal{position:absolute;top:15px;right:15px;font-size:1.6rem;cursor:pointer;color:var(--txt-faded);transition:.3s}
    .close-modal:hover{color:var(--txt-main)}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;border-bottom:1px solid var(--border);padding-bottom:8px;font-weight:600}
    .modal-header .breadcrumbs{font-size:.9rem;color:var(--txt-faded)}
    .modal-header .modal-profile-icon{width:40px;height:40px;border-radius:50%;background:var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.3s}
    .modal-header .modal-profile-icon:hover{background:var(--txt-faded)}
    .step-row{display:grid;grid-template-columns:minmax(110px,150px) minmax(200px,1fr) minmax(200px,1fr);gap:18px;margin-bottom:20px;align-items:start}
    @media(max-width:900px){.step-row{grid-template-columns:1fr}.step-circle{margin:0 auto 8px}}
    .step-circle{width:78px;height:78px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--txt-main);border:1px solid var(--border);background:var(--bg-main);text-align:center;font-size:.9rem;margin:0 auto}
    .step-input,.example-textarea{width:100%;height:100px;border:1px solid var(--border);border-radius:4px;padding:8px 10px;font-size:.9rem;resize:none;background:var(--bg-main);color:var(--txt-main)}
    .example-column{display:flex;flex-direction:column;gap:6px}
    .example-column label{font-weight:600;font-size:.85rem;color:var(--txt-faded)}
    .download-circle{width:40px;height:40px;border-radius:50%;background:var(--accent);color:#fff;display:flex;align-items:center;justify-content:center;font-size:1.25rem;cursor:pointer;transition:.3s}
    .download-circle:hover{filter:brightness(.9);transform:scale(1.08)}
  </style>
</head>
<body>
  <!------------ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ------------>
  <section id="authSection">
    <div class="auth-container">
      <div class="auth-tabs">
        <span class="auth-tab active" id="loginTab">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</span>
        <span id="toggleEmoji">‚áÜ</span>
        <span class="auth-tab" id="registerTab">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
      </div>
      <div id="loginForm" class="auth-form">
        <div class="auth-form-group">
          <label for="loginUsername">–õ–æ–≥–∏–Ω</label>
          <input type="text" id="loginUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω...">
        </div>
        <div class="auth-form-group">
          <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
          <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å...">
        </div>
        <div class="auth-buttons"><button id="loginBtn">–í–æ–π—Ç–∏</button></div>
      </div>
      <div id="registerForm" class="auth-form" style="display:none">
        <div class="auth-form-group">
          <label for="regUsername">–õ–æ–≥–∏–Ω</label>
          <input type="text" id="regUsername" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω...">
        </div>
        <div class="auth-form-group">
          <label for="regPassword">–ü–∞—Ä–æ–ª—å</label>
          <input type="password" id="regPassword" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å...">
        </div>
        <div class="auth-buttons"><button id="registerBtn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button></div>
      </div>
    </div>
  </section>

  <!------------ –û–°–ù–û–í–ù–û–ô –†–ê–ó–î–ï–õ ------------>
  <section id="mainSection">
    <header>
      <div class="logo">uppptip</div>
      <nav>
        <ul>
          <li>–ì–ª–∞–≤–Ω–∞—è</li><li>–°–æ–±—ã—Ç–∏—è</li><li>–û—Ç—á—ë—Ç—ã</li><li>–ö–µ–π—Å—ã</li>
        </ul>
      </nav>
      <div class="extra-right">
        <div class="search-bar">
          <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫">
          <span class="star-icon" id="favToggle">‚≠ê</span>
        </div>
        <span class="theme-toggle" id="themeToggle">üåû</span>
        <div class="profile-icon" id="profileIcon"><span>üë§</span></div>
      </div>
    </header>

    <main>
      <div class="cards-grid" id="cardsGrid"></div>
    </main>
    <footer>¬© 2025 uppptip</footer>

    <!-- –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–∞–ª–æ–∫ -->
    <div id="modalsContainer"></div>
  </section>

  <!------------ –õ–ò–ß–ù–´–ô –ö–ê–ë–ò–ù–ï–¢ ------------>
  <section id="cabinetSection">
    <div class="cabinet-container">
      <h2 class="cabinet-title">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
      <div class="cabinet-profile">
        <img id="cabinetAvatar" class="cabinet-avatar-img" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
        <div id="cabinetEmoji" class="cabinet-avatar-emoji">üòÉ</div>
        <div class="cabinet-username" id="cabinetUsername"></div>
      </div>
      <div class="cabinet-actions">
        <button class="cabinet-btn" id="openSettingsBtn">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
        <button class="cabinet-btn" id="backToMainBtn">–ù–∞–∑–∞–¥</button>
        <button class="cabinet-btn" id="logoutBtnCabinet">–í—ã–π—Ç–∏</button>
      </div>
      <div class="cabinet-settings-form" id="cabinetSettingsForm">
        <div class="cabinet-form-group">
          <label for="newUsername">–ù–æ–≤—ã–π –ª–æ–≥–∏–Ω</label>
          <input type="text" id="newUsername" placeholder="–ù–æ–≤—ã–π –ª–æ–≥–∏–Ω...">
        </div>
        <div class="cabinet-form-group">
          <label for="newPassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
          <input type="password" id="newPassword" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å...">
        </div>
        <div class="cabinet-form-group">
          <label for="avatarFile">–ù–æ–≤—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç</label>
          <input type="file" id="avatarFile" accept="image/*">
        </div>
        <button class="cabinet-save-btn" id="saveSettingsBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </section>

<script>
/*==================== ¬´–ë–ê–ó–ê¬ª –í localStorage ====================*/
let users = JSON.parse(localStorage.getItem('users')) || [];
let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
let favCards = JSON.parse(localStorage.getItem('favCards')) || []; // id –∫–∞—Ä—Ç–æ—á–µ–∫
let theme = localStorage.getItem('theme') || 'light';

/*==================== –î–ê–ù–ù–´–ï –ö–ê–†–¢–û–ß–ï–ö ====================*/
const cardData = [
  {id:'swot',  title:'SWOT-–∞–Ω–∞–ª–∏–∑',               steps:['–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã','–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã','–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏','–£–≥—Ä–æ–∑—ã']},
  {id:'pest',  title:'PEST-–∞–Ω–∞–ª–∏–∑',               steps:['–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ','–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ','–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ','–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ']},
  {id:'porter',title:'5 —Å–∏–ª –ü–æ—Ä—Ç–µ—Ä–∞',             steps:['–°–∏–ª–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤','–°–∏–ª–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π','–£–≥—Ä–æ–∑–∞ –Ω–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤','–£–≥—Ä–æ–∑–∞ –∑–∞–º–µ–Ω–∏—Ç–µ–ª–µ–π','–ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è —Å—Ä–µ–¥–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö']},
  {id:'lean',  title:'Lean Canvas',              steps:['–ü—Ä–æ–±–ª–µ–º—ã','–°–µ–≥–º–µ–Ω—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤','–£–¢–ü','–†–µ—à–µ–Ω–∏–µ','–ö–∞–Ω–∞–ª—ã','–î–æ—Ö–æ–¥—ã','–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞—Ç—Ä–∞—Ç']},
  {id:'bmc',   title:'Business Model Canvas',     steps:['–¶–ü','–ö–°','–ö–∞–Ω–∞–ª—ã','–í–∑–∞–∏–º–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è','–ü–æ—Ç–æ–∫–∏ –¥–æ—Ö–æ–¥–æ–≤','–ö–ª—é—á–µ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã','–ö–ª—é—á–µ–≤—ã–µ –≤–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏','–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä—Ç–Ω–µ—Ä—ã','–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞—Ç—Ä–∞—Ç']},
  {id:'vpc',   title:'Value Proposition Canvas',  steps:['–ü—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞','–ó–∞–¥–∞—á–∏ –∫–ª–∏–µ–Ω—Ç–∞','–ë–æ–ª–∏','–í—ã–≥–æ–¥—ã','–ü—Ä–æ–¥—É–∫—Ç/—É—Å–ª—É–≥–∞','–£—Å—Ç—Ä–∞–Ω–∏—Ç–µ–ª–∏ –±–æ–ª–µ–π','–°–æ–∑–¥–∞—Ç–µ–ª–∏ –≤—ã–≥–æ–¥']},
  {id:'smart', title:'SMART-—Ü–µ–ª–∏',                steps:['–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ—Å—Ç—å','–ò–∑–º–µ—Ä–∏–º–æ—Å—Ç—å','–î–æ—Å—Ç–∏–∂–∏–º–æ—Å—Ç—å','–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å','–°—Ä–æ–∫']},
  {id:'okr',   title:'OKR-–ø–ª–∞–Ω',                  steps:['Objective','Key Result 1','Key Result 2','Key Result 3']},
  {id:'raci',  title:'RACI-–º–∞—Ç—Ä–∏—Ü–∞',              steps:['–ó–∞–¥–∞—á–∞','–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π (R)','–£—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç (A)','–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–µ—Ç (C)','–ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç (I)']},
  {id:'kpi',   title:'KPI-–¥–∞—à–±–æ—Ä–¥',               steps:['–ú–µ—Ç—Ä–∏–∫–∞','–¢–µ–∫—É—â–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å','–¶–µ–ª—å','–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö']},
  {id:'risk',  title:'–ú–∞—Ç—Ä–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤',            steps:['–†–∏—Å–∫','–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å','–í–ª–∏—è–Ω–∏–µ','–°—Ç—Ä–∞—Ç–µ–≥–∏—è']},
  {id:'stake', title:'–ö–∞—Ä—Ç–∞ —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–æ–≤',       steps:['–°—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä','–ò–Ω—Ç–µ—Ä–µ—Å/–≤–ª–∏—è–Ω–∏–µ','–û–∂–∏–¥–∞–Ω–∏—è','–°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è']}
];

/*==================== DOM ====================*/
const authSection=document.getElementById('authSection');
const mainSection=document.getElementById('mainSection');
const cabinetSection=document.getElementById('cabinetSection');
const cardsGrid=document.getElementById('cardsGrid');
const modalsContainer=document.getElementById('modalsContainer');
const searchInput=document.getElementById('searchInput');
const favToggle=document.getElementById('favToggle');
const themeToggle=document.getElementById('themeToggle');

/*===== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø =====*/
const loginTab=document.getElementById('loginTab');
const registerTab=document.getElementById('registerTab');
const toggleEmoji=document.getElementById('toggleEmoji');
const loginForm=document.getElementById('loginForm');
const registerForm=document.getElementById('registerForm');
const loginBtn=document.getElementById('loginBtn');
const registerBtn=document.getElementById('registerBtn');
const loginUsername=document.getElementById('loginUsername');
const loginPassword=document.getElementById('loginPassword');
const regUsername=document.getElementById('regUsername');
const regPassword=document.getElementById('regPassword');

/*===== –õ–ò–ß–ù–´–ô –ö–ê–ë–ò–ù–ï–¢ =====*/
const cabinetUsername=document.getElementById('cabinetUsername');
const cabinetAvatar=document.getElementById('cabinetAvatar');
const cabinetEmoji=document.getElementById('cabinetEmoji');
const openSettingsBtn=document.getElementById('openSettingsBtn');
const cabinetSettingsForm=document.getElementById('cabinetSettingsForm');
const backToMainBtn=document.getElementById('backToMainBtn');
const logoutBtnCabinet=document.getElementById('logoutBtnCabinet');
const newUsername=document.getElementById('newUsername');
const newPassword=document.getElementById('newPassword');
const avatarFile=document.getElementById('avatarFile');
const saveSettingsBtn=document.getElementById('saveSettingsBtn');
const profileIcon=document.getElementById('profileIcon');

/*==================== –¢–ï–ú–ê ====================*/
function applyTheme(){
  document.body.classList.toggle('dark',theme==='dark');
  themeToggle.textContent=theme==='dark'?'üåö':'üåû';
}
applyTheme();
themeToggle.addEventListener('click',()=>{
  theme=theme==='dark'?'light':'dark';
  localStorage.setItem('theme',theme);
  applyTheme();
});

/*==================== –°–¢–†–ê–ù–ò–¶–´ ====================*/
function saveToLS(){
  localStorage.setItem('users',JSON.stringify(users));
  localStorage.setItem('currentUser',JSON.stringify(currentUser));
  localStorage.setItem('favCards',JSON.stringify(favCards));
}
function updateView(){
  if(currentUser){
    authSection.style.display='none';
    mainSection.style.display='block';
    cabinetSection.style.display='none';
  }else{
    authSection.style.display='flex';
    mainSection.style.display='none';
    cabinetSection.style.display='none';
  }
}
updateView();

/*==================== –°–º–µ–Ω–∞ —Ç–∞–±–æ–≤ ====================*/
function showLogin(){loginTab.classList.add('active');registerTab.classList.remove('active');loginForm.style.display='block';registerForm.style.display='none';toggleEmoji.style.transform='rotate(-45deg)'}
function showRegister(){registerTab.classList.add('active');loginTab.classList.remove('active');loginForm.style.display='none';registerForm.style.display='block';toggleEmoji.style.transform='rotate(45deg)'}
loginTab.onclick=showLogin;registerTab.onclick=showRegister;
toggleEmoji.onclick=()=>{loginForm.style.display==='block'?showRegister():showLogin()};

/*==================== –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ====================*/
function loginUser(){
  const u=loginUsername.value.trim(),p=loginPassword.value.trim();
  const user=users.find(x=>x.username===u && x.password===p);
  if(user){currentUser=user;saveToLS();alert('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!');updateView();}
  else alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
}
function registerUser(){
  const u=regUsername.value.trim(),p=regPassword.value.trim();
  if(!u||!p)return alert('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å');
  if(users.find(x=>x.username===u))return alert('–¢–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å');
  currentUser={username:u,password:p,avatar:''};
  users.push(currentUser);saveToLS();alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞');updateView();
}
loginBtn.onclick=loginUser;registerBtn.onclick=registerUser;

/*==================== –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ====================*/
function updateCabinetAvatar(){
  if(currentUser?.avatar){cabinetAvatar.src=currentUser.avatar;cabinetAvatar.style.display='block';cabinetEmoji.style.display='none'}
  else{cabinetAvatar.style.display='none';cabinetEmoji.style.display='block'}
}
function openCabinet(){
  if(!currentUser)return alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!');
  cabinetUsername.textContent=currentUser.username;
  updateCabinetAvatar();
  mainSection.style.display='none';cabinetSection.style.display='block';
}
profileIcon.onclick=openCabinet;
backToMainBtn.onclick=()=>{cabinetSection.style.display='none';mainSection.style.display='block'};
logoutBtnCabinet.onclick=()=>{currentUser=null;saveToLS();updateView()};
openSettingsBtn.onclick=()=>{cabinetSettingsForm.style.display=cabinetSettingsForm.style.display==='block'?'none':'block'};
saveSettingsBtn.onclick=()=>{
  if(!currentUser)return;
  const nu=newUsername.value.trim(),np=newPassword.value.trim();
  if(nu && nu!==currentUser.username){
    if(users.find(x=>x.username===nu && x!==currentUser))return alert('–õ–æ–≥–∏–Ω –∑–∞–Ω—è—Ç');
    currentUser.username=nu;
  }
  if(np) currentUser.password=np;
  if(avatarFile.files[0]){
    const reader=new FileReader();
    reader.onload=e=>{currentUser.avatar=e.target.result;finish();}
    reader.readAsDataURL(avatarFile.files[0]);
  }else finish();
  function finish(){
    users=users.map(x=>x===currentUser?currentUser:x);
    saveToLS();updateCabinetAvatar();
    newUsername.value='';newPassword.value='';avatarFile.value='';
    cabinetSettingsForm.style.display='none';alert('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
  }
};

/*==================== –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ –º–æ–¥–∞–ª–æ–∫ ====================*/
function createStepRow(stepText,idx,cardId){
  const roman=['I','II','III','IV','V','VI','VII','VIII','IX'];
  return `
  <div class="step-row">
    <div class="step-circle">${roman[idx]||idx+1}<br>—à–∞–≥</div>
    <textarea class="step-input" placeholder="${stepText}..." data-input="${cardId}_${idx}"></textarea>
    <div class="example-column">
      <label>–ü—Ä–∏–º–µ—Ä</label>
      <textarea class="example-textarea" placeholder="–ü—Ä–∏–º–µ—Ä: ${stepText.toLowerCase()}..." data-example="${cardId}_${idx}"></textarea>
      <div class="download-circle" title="–°–∫–∞—á–∞—Ç—å –ø—Ä–∏–º–µ—Ä" data-download="${cardId}_${idx}">‚¨á</div>
    </div>
  </div>`;
}
function buildInterface(){
  cardsGrid.innerHTML='';
  modalsContainer.innerHTML='';
  // —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –∏–∑–±—Ä–∞–Ω–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞
  const sorted=[...cardData].sort((a,b)=>{
    const af=favCards.includes(a.id),bf=favCards.includes(b.id);
    if(af&&!bf)return -1;if(!af&&bf)return 1;return 0;
  });
  for(const card of sorted){
    // –∫–∞—Ä—Ç–æ—á–∫–∞
    const cardDiv=document.createElement('div');
    cardDiv.className='card';
    cardDiv.dataset.id=card.id;
    cardDiv.textContent=card.title;
    if(favCards.includes(card.id))cardDiv.classList.add('fav');
    cardsGrid.appendChild(cardDiv);

    // –º–æ–¥–∞–ª–∫–∞
    const modal=document.createElement('div');
    modal.className='modal-overlay';
    modal.id=`modal_${card.id}`;
    modal.innerHTML=`
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <div class="modal-header">
          <div class="breadcrumbs">–ì–ª–∞–≤–Ω–∞—è / ${card.title}</div>
          <div class="modal-profile-icon">üë§</div>
        </div>
        ${card.steps.map((s,i)=>createStepRow(s,i,card.id)).join('')}
      </div>`;
    modalsContainer.appendChild(modal);
  }
}
buildInterface();

/*==================== –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫ ====================*/
function openModal(cardId){
  document.getElementById(`modal_${cardId}`).style.display='flex';
  // –ø–æ–¥–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  document.querySelectorAll(`[data-input^="${cardId}_"],[data-example^="${cardId}_"]`).forEach(el=>{
    const key=`${currentUser?.username||'guest'}_${el.dataset.input? 'input':'example'}_${el.dataset.input||el.dataset.example}`;
    el.value=localStorage.getItem(key)||'';
  });
}
cardsGrid.addEventListener('click',e=>{
  const card=e.target.closest('.card');
  if(!card)return;
  openModal(card.dataset.id);
});
modalsContainer.addEventListener('click',e=>{
  if(e.target.classList.contains('modal-overlay'))e.target.style.display='none';
  if(e.target.classList.contains('close-modal'))e.target.closest('.modal-overlay').style.display='none';
});

/*==================== –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π ====================*/
modalsContainer.addEventListener('input',e=>{
  if(e.target.matches('textarea')){
    const el=e.target;
    const type=el.dataset.input?'input':'example';
    const key=`${currentUser?.username||'guest'}_${type}_${el.dataset.input||el.dataset.example}`;
    localStorage.setItem(key,el.value);
  }
});

/*==================== –°–∫–∞—á–∞—Ç—å –ø—Ä–∏–º–µ—Ä ====================*/
modalsContainer.addEventListener('click',e=>{
  if(!e.target.dataset.download)return;
  const id=e.target.dataset.download;
  const ta=document.querySelector(`[data-example="${id}"]`);
  const blob=new Blob([ta.value],{type:'text/plain'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download=`${id}.txt`;
  document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
});

/*==================== –ü–æ–∏—Å–∫ ====================*/
searchInput.addEventListener('input',()=>{
  const q=searchInput.value.toLowerCase();
  document.querySelectorAll('.card').forEach(c=>{
    c.style.display=c.textContent.toLowerCase().includes(q)?'flex':'none';
  });
});

/*==================== –ò–∑–±—Ä–∞–Ω–Ω–æ–µ (‚≠ê) ====================*/
favToggle.onclick=()=>{
  favToggle.classList.toggle('active');
  if(favToggle.classList.contains('active')){
    alert('–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
    cardsGrid.addEventListener('click',toggleFavOnce,{once:true});
  }
  function toggleFavOnce(e){
    const card=e.target.closest('.card');if(!card)return;
    const id=card.dataset.id;
    if(favCards.includes(id))favCards=favCards.filter(x=>x!==id);else favCards.push(id);
    saveToLS();buildInterface();
    favToggle.classList.remove('active');
  }
};

/*==================== –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ====================*/
applyFavStars();
function applyFavStars(){
  document.querySelectorAll('.card').forEach(c=>{
    if(favCards.includes(c.dataset.id))c.style.borderColor='gold';
  });
}
</script>
</body>
</html>
